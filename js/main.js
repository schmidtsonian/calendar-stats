/// <reference path="definitions/jquery/jquery.d.ts"/>
var app;
(function (app) {
    var RippleButton = (function () {
        function RippleButton() {
        }
        RippleButton.prototype.init = function () {
            $(document)
                .on('click touched', '.ripple', function (e) {
                var $ripple = $('<i class="rippling" />'), $button = $(this), btnOffset = $button.offset(), xPos = e.pageX - btnOffset.left, yPos = e.pageY - btnOffset.top, size = 0, animateSize = Math.max($button.width(), $button.height()) * Math.PI;
                $ripple.css({
                    top: yPos,
                    left: xPos,
                    width: size,
                    height: size,
                    backgroundColor: $button.attr('ripple-color')
                })
                    .appendTo($button)
                    .animate({
                    width: animateSize,
                    height: animateSize,
                    opacity: 0
                }, 500, function () {
                    $(this).remove();
                });
            });
        };
        return RippleButton;
    }());
    app.RippleButton = RippleButton;
})(app || (app = {}));
/// <reference path="definitions/jquery/jquery.d.ts" />
/// <reference path="RippleButton.ts" />
var app;
(function (app) {
    ;
    var RippleButton = app.RippleButton;
    var Main = (function () {
        function Main() {
            this.pathCalendar = '../jsons/calendar.json';
            this.classNameDisable = 'disable';
            this.classNameEneable = 'eneable';
            this.classNameYear = 'year__name';
            this.delayActiveStats = 450;
            this.$container = $('#js-conainer');
            this.$year = $('#js-year', this.$container);
            this.$stats = $('.js-stats', this.$container);
            this.$btPrev = $('#js-nav-prev');
            this.$btNext = $('#js-nav-next');
            this.rippleButton = new RippleButton();
        }
        Main.prototype.init = function () {
            this
                .bindings()
                .loadCalendar()
                .then(this.getLastYear.bind(this))
                .then(this.setYears.bind(this))
                .then(this.getStats.bind(this))
                .then(this.setStats.bind(this));
        };
        Main.prototype.bindings = function () {
            var _this = this;
            this.rippleButton.init();
            $(document)
                .keydown(function (e) {
                switch (e.which) {
                    // left
                    case 37:
                        _this.loadYear(_this.currentYear - 1, e);
                        break;
                    case 40:
                        _this.loadYear(_this.currentYear - 1, e);
                        break;
                    // right
                    case 39:
                        _this.loadYear(_this.currentYear + 1, e);
                        break;
                    case 38:
                        _this.loadYear(_this.currentYear + 1, e);
                        break;
                    case 32:
                        _this.loadYear(_this.currentYear + 1, e);
                        break;
                }
                ;
            });
            this.$container
                .swipe({
                swipe: function (e, direction, dist, dur, count, data) {
                    if (direction == 'left')
                        _this.loadYear(_this.currentYear + 1);
                    if (direction == 'right')
                        _this.loadYear(_this.currentYear - 1);
                },
            });
            this.$btPrev.on('click touched', function () { _this.loadYear(_this.currentYear - 1); });
            this.$btNext.on('click touched', function () { _this.loadYear(_this.currentYear + 1); });
            return this;
        };
        // private loadCalendar(): JQueryPromise<{}> {
        //     return $.getJSON( this.pathCalendar );
        // }
        Main.prototype.loadCalendar = function () {
            var defer = $.Deferred();
            defer.resolve({
                "calendar": [
                    { "name": 2010, "months": [54, 25, 55, 30, 50, 24, 52, 12, 54, 70, 80, 34] },
                    { "name": 2011, "months": [35, 60, 34, 22, 64, 65, 40, 80, 90, 44, 10, 92] },
                    { "name": 2012, "months": [80, 95, 44, 54, 17, 32, 74, 45, 75, 90, 72, 74] },
                    { "name": 2013, "months": [10, 25, 44, 54, 17, 32, 74, 45, 75, 90, 72, 74] },
                    { "name": 2014, "months": [54, 25, 55, 30, 50, 24, 52, 12, 54, 70, 80, 34] },
                    { "name": 2015, "months": [35, 60, 34, 22, 64, 65, 40, 80, 90, 44, 64, 62] },
                    { "name": 2016, "months": [50, 70, 44, 54, 95, 12, 74, 45, 75, 90, 72, 74] }
                ]
            });
            return defer.promise();
        };
        Main.prototype.getLastYear = function (data) {
            var defer = $.Deferred();
            this.data = data;
            this.currentYear = this.data.calendar[this.data.calendar.length - 1].name;
            defer.resolve();
            return defer.promise();
        };
        Main.prototype.setYears = function () {
            var defer = $.Deferred();
            this.$year.html('');
            for (var i = this.data.calendar.length - 1; i >= 0; i--) {
                var digits = ('' + this.data.calendar[i].name).split('');
                var year = '';
                for (var ii = 0; ii < digits.length; ii++) {
                    year += '<span>' + digits[ii] + '</span>';
                }
                this.$year.append('<div class="' + this.classNameYear + '">' + year + '</div>');
            }
            defer.resolve();
            return defer.promise();
        };
        Main.prototype.getStats = function (yearName) {
            if (yearName === void 0) { yearName = this.currentYear; }
            var defer = $.Deferred();
            for (var i = this.data.calendar.length - 1; i >= 0; i--) {
                if (this.data.calendar[i].name == yearName) {
                    defer.resolve(this.data.calendar[i]);
                    return defer.promise();
                }
            }
            defer.resolve(null);
            return defer.promise();
        };
        Main.prototype.setStats = function (year) {
            var defer = $.Deferred();
            if (year) {
                this.currentYear = year.name;
                this.currentStats = year.months;
                if (this.isFirstYear()) {
                    this.$btNext.css({ 'display': 'none' });
                }
                else {
                    this.$btNext.css({ 'display': 'block' });
                }
                if (this.isLAstYear()) {
                    this.$btPrev.css({ 'display': 'none' });
                }
                else {
                    this.$btPrev.css({ 'display': 'block' });
                }
                this.displayData();
            }
            defer.resolve(null);
            return defer.promise();
        };
        Main.prototype.displayData = function () {
            var _this = this;
            this.$container.addClass(this.classNameDisable);
            setTimeout(function () {
                _this.$container.removeClass(_this.classNameDisable);
            }, this.delayActiveStats);
            var $yearsName = $('.' + this.classNameYear);
            $yearsName.removeClass(this.classNameEneable);
            for (var i = $yearsName.length - 1; i >= 0; i--) {
                if ($yearsName.eq(i).text() == this.currentYear + '') {
                    $yearsName.eq(i).addClass(this.classNameEneable);
                    break;
                }
            }
            this.$stats.removeClass('highlight__high');
            this.$stats.removeClass('highlight__low');
            var max = Math.max.apply(Math, this.currentStats);
            var min = Math.min.apply(Math, this.currentStats);
            for (var i = this.currentStats.length - 1; i >= 0; i--) {
                var $el = this.$stats.eq(i);
                $el
                    .find('.bar')
                    .css({ 'height': (100 - this.currentStats[i]) + '%' });
                if (max == this.currentStats[i]) {
                    $el.addClass('highlight__high');
                }
                else if (min == this.currentStats[i]) {
                    $el.addClass('highlight__low');
                }
            }
        };
        Main.prototype.isLAstYear = function () {
            return this.data.calendar[0].name == this.currentYear;
        };
        Main.prototype.isFirstYear = function () {
            return this.data.calendar[this.data.calendar.length - 1].name == this.currentYear;
        };
        Main.prototype.loadYear = function (yearName, e) {
            if (e)
                e.preventDefault(); // prevent the default action (scroll / move caret)
            this
                .getStats(yearName)
                .then(this.setStats.bind(this));
        };
        return Main;
    }());
    app.Main = Main;
})(app || (app = {}));
var main;
$('document')
    .ready(function () {
    main = new app.Main();
    main.init();
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJpcHBsZUJ1dHRvbi50cyIsIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXRELElBQVUsR0FBRyxDQW1DWjtBQW5DRCxXQUFVLEdBQUcsRUFBQyxDQUFDO0lBRWI7UUFBQTtRQWdDQSxDQUFDO1FBOUJDLDJCQUFJLEdBQUo7WUFFRSxDQUFDLENBQUMsUUFBUSxDQUFDO2lCQUNWLEVBQUUsQ0FBQyxlQUFlLEVBQUUsU0FBUyxFQUFFLFVBQVMsQ0FBQztnQkFFeEMsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFFLHdCQUF3QixDQUFFLEVBQ3pDLE9BQU8sR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQ2pCLFNBQVMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQzVCLElBQUksR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxJQUFJLEVBQy9CLElBQUksR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxHQUFHLEVBQzlCLElBQUksR0FBRyxDQUFDLEVBQ1IsV0FBVyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBRXRFLE9BQU8sQ0FBQyxHQUFHLENBQUM7b0JBQ1YsR0FBRyxFQUFFLElBQUk7b0JBQ1QsSUFBSSxFQUFFLElBQUk7b0JBQ1YsS0FBSyxFQUFFLElBQUk7b0JBQ1gsTUFBTSxFQUFFLElBQUk7b0JBQ1osZUFBZSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUUsY0FBYyxDQUFFO2lCQUNoRCxDQUFDO3FCQUNDLFFBQVEsQ0FBQyxPQUFPLENBQUM7cUJBQ2pCLE9BQU8sQ0FBQztvQkFDUCxLQUFLLEVBQUUsV0FBVztvQkFDbEIsTUFBTSxFQUFFLFdBQVc7b0JBQ25CLE9BQU8sRUFBRSxDQUFDO2lCQUNYLEVBQUUsR0FBRyxFQUFFO29CQUNOLENB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WCxVQUFVLEVBQUU7b0JBQ1IsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFFLEVBQUU7b0JBQzdFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBRSxFQUFFO29CQUM3RSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUUsRUFBRTtvQkFDN0UsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFFLEVBQUU7b0JBQzdFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBRSxFQUFFO29CQUM3RSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUUsRUFBRTtvQkFDN0UsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFFLEVBQUU7aUJBQ2hGO2FBQ0osQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMzQixDQUFDO1FBRU8sMEJBQVcsR0FBbkIsVUFBcUIsSUFBYztZQUUvQixJQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFM0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFFLENBQUMsSUFBSSxDQUFDO1lBRTVFLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUVoQixNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzNCLENBQUM7UUFFTyx1QkFBUSxHQUFoQjtZQUNJLElBQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUUzQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNwQixHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUcsQ0FBQztnQkFFeEQsSUFBTSxNQUFNLEdBQUcsQ0FBRSxFQUFFLEdBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFFLENBQUMsS0FBSyxDQUFFLEVBQUUsQ0FBRSxDQUFDO2dCQUVoRSxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7Z0JBRWQsR0FBRyxDQUFDLENBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFHLENBQUM7b0JBRTFDLElBQUksSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFFLEVBQUUsQ0FBRSxHQUFHLFNBQVMsQ0FBQztnQkFDaEQsQ0FBQztnQkFFRCxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLEdBQUcsSUFBSSxHQUFHLFFBQVEsQ0FBQyxDQUFDO1lBQ3BGLENBQUM7WUFFRCxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7WUFFaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMzQixDQUFDO1FBRU8sdUJBQVEsR0FBaEIsVUFBa0IsUUFBbUM7WUFBbkMsd0JBQW1DLEdBQW5DLFdBQW1CLElBQUksQ0FBQyxXQUFXO1lBRWpELElBQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUUzQixHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUcsQ0FBQztnQkFFeEQsRUFBRSxDQUFBLENBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUUsQ0FBQyxDQUFFLENBQUMsSUFBSSxJQUFJLFFBQVMsQ0FBQyxDQUFDLENBQUM7b0JBRTVDLEtBQUssQ0FBQyxPQUFPLENBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUUsQ0FBQyxDQUFFLENBQUUsQ0FBQztvQkFFekMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDM0IsQ0FBQztZQUNMLENBQUM7WUFFRCxLQUFLLENBQUMsT0FBTyxDQUFFLElBQUksQ0FBRSxDQUFDO1lBRXRCLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDM0IsQ0FBQztRQUVPLHVCQUFRLEdBQWhCLFVBQWtCLElBQVU7WUFFeEIsSUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRTNCLEVBQUUsQ0FBQSxDQUFFLElBQUssQ0FBQyxDQUFBLENBQUM7Z0JBQ1AsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUM3QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBRWhDLEVBQUUsQ0FBQSxDQUFFLElBQUksQ0FBQyxXQUFXLEVBQUcsQ0FBQyxDQUFBLENBQUM7b0JBQ3JCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUMsU0FBUyxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7Z0JBQzFDLENBQUM7Z0JBQUEsSUFBSSxDQUFBLENBQUM7b0JBQ0YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBQyxTQUFTLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztnQkFDM0MsQ0FBQztnQkFFRCxFQUFFLENBQUEsQ0FBRSxJQUFJLENBQUMsVUFBVSxFQUFHLENBQUMsQ0FBQSxDQUFDO29CQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO2dCQUMxQyxDQUFDO2dCQUFBLElBQUksQ0FBQSxDQUFDO29CQUNGLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUMsU0FBUyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7Z0JBQzNDLENBQUM7Z0JBRUQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3ZCLENBQUM7WUFFRCxLQUFLLENBQUMsT0FBTyxDQUFFLElBQUksQ0FBRSxDQUFDO1lBRXRCLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDM0IsQ0FBQztRQUVPLDBCQUFXLEdBQW5CO1lBQUEsaUJBb0NDO1lBbENHLElBQUksQ0FBQyxVQUFVLENBQUUsUUFBUSxDQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBRSxDQUFDO1lBRW5ELFVBQVUsQ0FBRTtnQkFFUixLQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBRSxLQUFJLENBQUMsZ0JBQWdCLENBQUUsQ0FBQztZQUN6RCxDQUFDLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFFLENBQUM7WUFFM0IsSUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDL0MsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUU5QyxHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxHQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFHLENBQUM7Z0JBQzlDLEVBQUUsQ0FBQSxDQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFHLENBQUMsQ0FBQyxDQUFDO29CQUVwRCxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUUsQ0FBQztvQkFDbkQsS0FBSyxDQUFDO2dCQUNWLENBQUM7WUFDTCxDQUFDO1lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUUsaUJBQWlCLENBQUUsQ0FBQztZQUM3QyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBRSxnQkFBZ0IsQ0FBRSxDQUFDO1lBRTVDLElBQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFFLElBQUksRUFBQyxJQUFJLENBQUMsWUFBWSxDQUFFLENBQUM7WUFDckQsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUUsSUFBSSxFQUFDLElBQUksQ0FBQyxZQUFZLENBQUUsQ0FBQztZQUVyRCxHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRyxDQUFDO2dCQUV2RCxJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFOUIsR0FBRztxQkFDRixJQUFJLENBQUMsTUFBTSxDQUFDO3FCQUNaLEdBQUcsQ0FBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUUsQ0FBQztnQkFFekQsRUFBRSxDQUFLLENBQUUsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFFLENBQUMsQ0FBQSxDQUFDO29CQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUUsaUJBQWlCLENBQUMsQ0FBQztnQkFBQyxDQUFDO2dCQUMzRSxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUUsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFFLENBQUMsQ0FBQSxDQUFDO29CQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUUsZ0JBQWdCLENBQUUsQ0FBQztnQkFBQyxDQUFDO1lBQy9FLENBQUM7UUFDTCxDQUFDO1FBRU8seUJBQVUsR0FBbEI7WUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUUsQ0FBQyxDQUFFLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDNUQsQ0FBQztRQUVPLDBCQUFXLEdBQW5CO1lBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUUsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUN4RixDQUFDO1FBRU8sdUJBQVEsR0FBaEIsVUFBa0IsUUFBZ0IsRUFBRSxDQUF3QjtZQUV4RCxFQUFFLENBQUEsQ0FBRSxDQUFFLENBQUM7Z0JBQUMsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsbURBQW1EO1lBRS9FLElBQUk7aUJBQ0MsUUFBUSxDQUFDLFFBQVEsQ0FBQztpQkFDbEIsSUFBSSxDQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFFLElBQUksQ0FBRSxDQUFFLENBQUM7UUFDNUMsQ0FBQztRQUNMLFdBQUM7SUFBRCxDQXJQQSxBQXFQQyxJQUFBO0lBclBZLFFBQUksT0FxUGhCLENBQUE7QUFDTCxDQUFDLEVBblFTLEdBQUcsS0FBSCxHQUFHLFFBbVFaO0FBRUQsSUFBSSxJQUFTLENBQUM7QUFHZCxDQUFDLENBQUMsVUFBVSxDQUFDO0tBQ1osS0FBSyxDQUFFO0lBQ0osSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3RCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNoQixDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cImRlZmluaXRpb25zL2pxdWVyeS9qcXVlcnkuZC50c1wiLz5cblxubmFtZXNwYWNlIGFwcCB7XG5cbiAgZXhwb3J0IGNsYXNzIFJpcHBsZUJ1dHRvbiB7XG5cbiAgICBpbml0KCk6IHZvaWQge1xuXG4gICAgICAkKGRvY3VtZW50KVxuICAgICAgLm9uKCdjbGljayB0b3VjaGVkJywgJy5yaXBwbGUnLCBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgdmFyICRyaXBwbGUgPSAkKCAnPGkgY2xhc3M9XCJyaXBwbGluZ1wiIC8+JyApLFxuICAgICAgICAgICRidXR0b24gPSAkKHRoaXMpLFxuICAgICAgICAgIGJ0bk9mZnNldCA9ICRidXR0b24ub2Zmc2V0KCksXG4gICAgICAgICAgeFBvcyA9IGUucGFnZVggLSBidG5PZmZzZXQubGVmdCxcbiAgICAgICAgICB5UG9zID0gZS5wYWdlWSAtIGJ0bk9mZnNldC50b3AsXG4gICAgICAgICAgc2l6ZSA9IDAsXG4gICAgICAgICAgYW5pbWF0ZVNpemUgPSBNYXRoLm1heCgkYnV0dG9uLndpZHRoKCksICRidXR0b24uaGVpZ2h0KCkpICogTWF0aC5QSTtcblxuICAgICAgICAkcmlwcGxlLmNzcyh7XG4gICAgICAgICAgdG9wOiB5UG9zLFxuICAgICAgICAgIGxlZnQ6IHhQb3MsXG4gICAgICAgICAgd2lkdGg6IHNpemUsXG4gICAgICAgICAgaGVpZ2h0OiBzaXplLFxuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJGJ1dHRvbi5hdHRyKCAncmlwcGxlLWNvbG9yJyApXG4gICAgICAgIH0pXG4gICAgICAgICAgLmFwcGVuZFRvKCRidXR0b24pXG4gICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgd2lkdGg6IGFuaW1hdGVTaXplLFxuICAgICAgICAgICAgaGVpZ2h0OiBhbmltYXRlU2l6ZSxcbiAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICB9LCA1MDAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJkZWZpbml0aW9ucy9qcXVlcnkvanF1ZXJ5LmQudHNcIiAvPlxuXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiUmlwcGxlQnV0dG9uLnRzXCIgLz5cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vXG4vLyB0aGlzIGlzIG9ubHkgYW4gZXhlcmNpY2UsIHRoZSBwcm9taXNlcyBhcmUganVzdCBmb3IgcHJhY3RpY2Vcbi8vXG4vL1xuXG5pbnRlcmZhY2UgSlF1ZXJ5IHtcbiAgICBzd2lwZShzd2lwZTogYW55KTogYW55XG59XG5cbm5hbWVzcGFjZSBhcHAge1xuXG4gICAgaW50ZXJmYWNlIFllYXIge1xuICAgICAgICBuYW1lOiBudW1iZXI7XG4gICAgICAgIG1vbnRoczogW251bWJlcl07XG4gICAgfTtcblxuICAgIGludGVyZmFjZSBDYWxlbmRhciB7XG4gICAgICAgIGNhbGVuZGFyOiBbWWVhcl07XG4gICAgfVxuXG4gICAgaW1wb3J0IFJpcHBsZUJ1dHRvbiA9IGFwcC5SaXBwbGVCdXR0b247XG5cbiAgICBleHBvcnQgY2xhc3MgTWFpbiB7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHBhdGhDYWxlbmRhciAgICAgOiBzdHJpbmc7XG4gICAgICAgIHByaXZhdGUgZGF0YSAgICAgICAgICAgICA6IENhbGVuZGFyO1xuICAgICAgICBwcml2YXRlIHJpcHBsZUJ1dHRvbiAgICAgOiBSaXBwbGVCdXR0b247XG5cbiAgICAgICAgcHJpdmF0ZSBjdXJyZW50WWVhciAgICAgIDogbnVtYmVyO1xuICAgICAgICBwcml2YXRlIGN1cnJlbnRTdGF0cyAgICAgOiBbbnVtYmVyXTtcblxuICAgICAgICBwcml2YXRlIGNsYXNzTmFtZURpc2FibGUgOiBzdHJpbmc7XG4gICAgICAgIHByaXZhdGUgY2xhc3NOYW1lRW5lYWJsZSA6IHN0cmluZztcbiAgICAgICAgcHJpdmF0ZSBjbGFzc05hbWVZZWFyICAgIDogc3RyaW5nO1xuXG4gICAgICAgIHByaXZhdGUgZGVsYXlBY3RpdmVTdGF0cyA6IG51bWJlcjsgLy9pbiBtaWxsaXNlY29uZHNcblxuICAgICAgICBwcml2YXRlICRjb250YWluZXIgICAgICAgOiBKUXVlcnk7XG4gICAgICAgIHByaXZhdGUgJHllYXIgICAgICAgICAgICA6IEpRdWVyeTtcbiAgICAgICAgcHJpdmF0ZSAkc3RhdHMgICAgICAgICAgIDogSlF1ZXJ5O1xuICAgICAgICBwcml2YXRlICRidFByZXYgICAgICAgICAgOiBKUXVlcnk7XG4gICAgICAgIHByaXZhdGUgJGJ0TmV4dCAgICAgICAgICA6IEpRdWVyeTtcblxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcblxuICAgICAgICAgICAgdGhpcy5wYXRoQ2FsZW5kYXIgICAgID0gJy4uL2pzb25zL2NhbGVuZGFyLmpzb24nO1xuICAgICAgICAgICAgdGhpcy5jbGFzc05hbWVEaXNhYmxlID0gJ2Rpc2FibGUnO1xuICAgICAgICAgICAgdGhpcy5jbGFzc05hbWVFbmVhYmxlID0gJ2VuZWFibGUnO1xuICAgICAgICAgICAgdGhpcy5jbGFzc05hbWVZZWFyICAgID0gJ3llYXJfX25hbWUnO1xuXG4gICAgICAgICAgICB0aGlzLmRlbGF5QWN0aXZlU3RhdHMgPSA0NTA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lciAgICAgICA9ICQoICcjanMtY29uYWluZXInIClcbiAgICAgICAgICAgIHRoaXMuJHllYXIgICAgICAgICAgICA9ICQoICcjanMteWVhcicsIHRoaXMuJGNvbnRhaW5lciApO1xuICAgICAgICAgICAgdGhpcy4kc3RhdHMgICAgICAgICAgID0gJCggJy5qcy1zdGF0cycsIHRoaXMuJGNvbnRhaW5lciApO1xuXG4gICAgICAgICAgICB0aGlzLiRidFByZXYgICAgICAgICAgPSAkKCAnI2pzLW5hdi1wcmV2JyApO1xuICAgICAgICAgICAgdGhpcy4kYnROZXh0ICAgICAgICAgID0gJCggJyNqcy1uYXYtbmV4dCcgKTtcblxuICAgICAgICAgICAgdGhpcy5yaXBwbGVCdXR0b24gPSBuZXcgUmlwcGxlQnV0dG9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpbml0KCkge1xuXG4gICAgICAgICAgICB0aGlzXG4gICAgICAgICAgICAgICAgLmJpbmRpbmdzKClcbiAgICAgICAgICAgICAgICAubG9hZENhbGVuZGFyKClcbiAgICAgICAgICAgICAgICAudGhlbiggdGhpcy5nZXRMYXN0WWVhci5iaW5kKCB0aGlzICkgKVxuICAgICAgICAgICAgICAgIC50aGVuKCB0aGlzLnNldFllYXJzLmJpbmQoIHRoaXMgKSApXG4gICAgICAgICAgICAgICAgLnRoZW4oIHRoaXMuZ2V0U3RhdHMuYmluZCggdGhpcyApIClcbiAgICAgICAgICAgICAgICAudGhlbiggdGhpcy5zZXRTdGF0cy5iaW5kKCB0aGlzICkgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgYmluZGluZ3MoKTogdGhpcyB7XG5cbiAgICAgICAgICAgIHRoaXMucmlwcGxlQnV0dG9uLmluaXQoKTtcblxuICAgICAgICAgICAgJCggZG9jdW1lbnQgKVxuICAgICAgICAgICAgLmtleWRvd24oICggZTogSlF1ZXJ5S2V5RXZlbnRPYmplY3QgKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2goIGUud2hpY2ggKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGxlZnRcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzogdGhpcy5sb2FkWWVhciggdGhpcy5jdXJyZW50WWVhciAtIDEsIGUgKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6IHRoaXMubG9hZFllYXIoIHRoaXMuY3VycmVudFllYXIgLSAxLCBlICk7IGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJpZ2h0XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6IHRoaXMubG9hZFllYXIoIHRoaXMuY3VycmVudFllYXIgKyAxLCBlICk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM4OiB0aGlzLmxvYWRZZWFyKCB0aGlzLmN1cnJlbnRZZWFyICsgMSwgZSApOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjogdGhpcy5sb2FkWWVhciggdGhpcy5jdXJyZW50WWVhciArIDEsIGUgKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXJcbiAgICAgICAgICAgIC5zd2lwZSgge1xuICAgICAgICAgICAgICAgIHN3aXBlOiAoIGU6IGFueSwgZGlyZWN0aW9uOiBhbnksIGRpc3Q6IGFueSwgZHVyOiBhbnksIGNvdW50OiBhbnksIGRhdGE6IGFueSApID0+IHtcblxuICAgICAgICAgICAgICAgICAgaWYoIGRpcmVjdGlvbiA9PSAnbGVmdCcgICkgdGhpcy5sb2FkWWVhciggdGhpcy5jdXJyZW50WWVhciArIDEgKTtcbiAgICAgICAgICAgICAgICAgIGlmKCBkaXJlY3Rpb24gPT0gJ3JpZ2h0JyApIHRoaXMubG9hZFllYXIoIHRoaXMuY3VycmVudFllYXIgLSAxICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLiRidFByZXYub24oJ2NsaWNrIHRvdWNoZWQnLCAoKSA9PiB7IHRoaXMubG9hZFllYXIoIHRoaXMuY3VycmVudFllYXIgLSAxICkgfSApO1xuICAgICAgICAgICAgdGhpcy4kYnROZXh0Lm9uKCdjbGljayB0b3VjaGVkJywgKCkgPT4geyB0aGlzLmxvYWRZZWFyKCB0aGlzLmN1cnJlbnRZZWFyICsgMSApIH0gKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBwcml2YXRlIGxvYWRDYWxlbmRhcigpOiBKUXVlcnlQcm9taXNlPHt9PiB7XG5cbiAgICAgICAgLy8gICAgIHJldHVybiAkLmdldEpTT04oIHRoaXMucGF0aENhbGVuZGFyICk7XG4gICAgICAgIC8vIH1cblxuICAgICAgICBwcml2YXRlIGxvYWRDYWxlbmRhcigpOiBKUXVlcnlQcm9taXNlPHt9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IGRlZmVyID0gJC5EZWZlcnJlZCgpO1xuXG4gICAgICAgICAgICBkZWZlci5yZXNvbHZlKCB7XG4gICAgICAgICAgICAgICAgXCJjYWxlbmRhclwiOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcIm5hbWVcIjogMjAxMCwgXCJtb250aHNcIjogWyA1NCwgMjUsIDU1LCAzMCwgNTAsIDI0LCA1MiwgMTIsIDU0LCA3MCwgODAsIDM0IF0gfSxcbiAgICAgICAgICAgICAgICAgICAge1wibmFtZVwiOiAyMDExLCBcIm1vbnRoc1wiOiBbIDM1LCA2MCwgMzQsIDIyLCA2NCwgNjUsIDQwLCA4MCwgOTAsIDQ0LCAxMCwgOTIgXSB9LFxuICAgICAgICAgICAgICAgICAgICB7XCJuYW1lXCI6IDIwMTIsIFwibW9udGhzXCI6IFsgODAsIDk1LCA0NCwgNTQsIDE3LCAzMiwgNzQsIDQ1LCA3NSwgOTAsIDcyLCA3NCBdIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcIm5hbWVcIjogMjAxMywgXCJtb250aHNcIjogWyAxMCwgMjUsIDQ0LCA1NCwgMTcsIDMyLCA3NCwgNDUsIDc1LCA5MCwgNzIsIDc0IF0gfSxcbiAgICAgICAgICAgICAgICAgICAge1wibmFtZVwiOiAyMDE0LCBcIm1vbnRoc1wiOiBbIDU0LCAyNSwgNTUsIDMwLCA1MCwgMjQsIDUyLCAxMiwgNTQsIDcwLCA4MCwgMzQgXSB9LFxuICAgICAgICAgICAgICAgICAgICB7XCJuYW1lXCI6IDIwMTUsIFwibW9udGhzXCI6IFsgMzUsIDYwLCAzNCwgMjIsIDY0LCA2NSwgNDAsIDgwLCA5MCwgNDQsIDY0LCA2MiBdIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcIm5hbWVcIjogMjAxNiwgXCJtb250aHNcIjogWyA1MCwgNzAsIDQ0LCA1NCwgOTUsIDEyLCA3NCwgNDUsIDc1LCA5MCwgNzIsIDc0IF0gfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBnZXRMYXN0WWVhciggZGF0YTogQ2FsZW5kYXIgKTogSlF1ZXJ5UHJvbWlzZTx7fT4ge1xuXG4gICAgICAgICAgICBjb25zdCBkZWZlciA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFllYXIgPSB0aGlzLmRhdGEuY2FsZW5kYXJbIHRoaXMuZGF0YS5jYWxlbmRhci5sZW5ndGggLSAxIF0ubmFtZTtcblxuICAgICAgICAgICAgZGVmZXIucmVzb2x2ZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBzZXRZZWFycygpOiBKUXVlcnlQcm9taXNlPHt9PiB7XG4gICAgICAgICAgICBjb25zdCBkZWZlciA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICAgICAgdGhpcy4keWVhci5odG1sKCcnKTtcbiAgICAgICAgICAgIGZvciAoIGxldCBpID0gdGhpcy5kYXRhLmNhbGVuZGFyLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGRpZ2l0cyA9ICggJycgKyAgdGhpcy5kYXRhLmNhbGVuZGFyW2ldLm5hbWUgKS5zcGxpdCggJycgKTtcblxuICAgICAgICAgICAgICAgIGxldCB5ZWFyID0gJyc7XG5cbiAgICAgICAgICAgICAgICBmb3IgKCBsZXQgaWkgPSAwOyBpaSA8IGRpZ2l0cy5sZW5ndGg7IGlpKysgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgeWVhciArPSAnPHNwYW4+JyArIGRpZ2l0c1sgaWkgXSArICc8L3NwYW4+JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLiR5ZWFyLmFwcGVuZCgnPGRpdiBjbGFzcz1cIicgKyB0aGlzLmNsYXNzTmFtZVllYXIgKyAnXCI+JyArIHllYXIgKyAnPC9kaXY+Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgZ2V0U3RhdHMoIHllYXJOYW1lOiBudW1iZXIgPSB0aGlzLmN1cnJlbnRZZWFyICk6IEpRdWVyeVByb21pc2U8WWVhcj4ge1xuXG4gICAgICAgICAgICBjb25zdCBkZWZlciA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICAgICAgZm9yICggbGV0IGkgPSB0aGlzLmRhdGEuY2FsZW5kYXIubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XG5cbiAgICAgICAgICAgICAgICBpZiggdGhpcy5kYXRhLmNhbGVuZGFyWyBpIF0ubmFtZSA9PSB5ZWFyTmFtZSApIHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoIHRoaXMuZGF0YS5jYWxlbmRhclsgaSBdICk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGVmZXIucmVzb2x2ZSggbnVsbCApO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBzZXRTdGF0cyggeWVhcjogWWVhciApOiBKUXVlcnlQcm9taXNlPFllYXI+IHtcblxuICAgICAgICAgICAgY29uc3QgZGVmZXIgPSAkLkRlZmVycmVkKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKCB5ZWFyICl7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50WWVhciA9IHllYXIubmFtZTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0cyA9IHllYXIubW9udGhzO1xuXG4gICAgICAgICAgICAgICAgaWYoIHRoaXMuaXNGaXJzdFllYXIoKSApe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRidE5leHQuY3NzKHsnZGlzcGxheSc6ICdub25lJ30pO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRidE5leHQuY3NzKHsnZGlzcGxheSc6ICdibG9jayd9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiggdGhpcy5pc0xBc3RZZWFyKCkgKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnRQcmV2LmNzcyh7J2Rpc3BsYXknOiAnbm9uZSd9KTtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnRQcmV2LmNzcyh7J2Rpc3BsYXknOiAnYmxvY2snfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5RGF0YSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkZWZlci5yZXNvbHZlKCBudWxsICk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBwcml2YXRlIGRpc3BsYXlEYXRhKCkge1xuXG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIgLmFkZENsYXNzKCB0aGlzLmNsYXNzTmFtZURpc2FibGUgKTtcblxuICAgICAgICAgICAgc2V0VGltZW91dCggKCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnJlbW92ZUNsYXNzKCB0aGlzLmNsYXNzTmFtZURpc2FibGUgKTtcbiAgICAgICAgICAgIH0sIHRoaXMuZGVsYXlBY3RpdmVTdGF0cyApO1xuXG4gICAgICAgICAgICBjb25zdCAkeWVhcnNOYW1lID0gJCgnLicgKyB0aGlzLmNsYXNzTmFtZVllYXIpO1xuICAgICAgICAgICAgJHllYXJzTmFtZS5yZW1vdmVDbGFzcyh0aGlzLmNsYXNzTmFtZUVuZWFibGUpO1xuXG4gICAgICAgICAgICBmb3IgKCBsZXQgaSA9ICR5ZWFyc05hbWUubGVuZ3RoLTE7IGkgPj0gMDsgaS0tICkge1xuICAgICAgICAgICAgICAgIGlmKCAkeWVhcnNOYW1lLmVxKGkpLnRleHQoKSA9PSB0aGlzLmN1cnJlbnRZZWFyICsgJycgKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAkeWVhcnNOYW1lLmVxKGkpLmFkZENsYXNzKCB0aGlzLmNsYXNzTmFtZUVuZWFibGUgKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy4kc3RhdHMucmVtb3ZlQ2xhc3MoICdoaWdobGlnaHRfX2hpZ2gnICk7XG4gICAgICAgICAgICB0aGlzLiRzdGF0cy5yZW1vdmVDbGFzcyggJ2hpZ2hsaWdodF9fbG93JyApO1xuXG4gICAgICAgICAgICBjb25zdCBtYXggPSBNYXRoLm1heC5hcHBseSggTWF0aCx0aGlzLmN1cnJlbnRTdGF0cyApO1xuICAgICAgICAgICAgY29uc3QgbWluID0gTWF0aC5taW4uYXBwbHkoIE1hdGgsdGhpcy5jdXJyZW50U3RhdHMgKTtcblxuICAgICAgICAgICAgZm9yICggbGV0IGkgPSB0aGlzLmN1cnJlbnRTdGF0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSApIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjb25zdCAkZWwgPSB0aGlzLiRzdGF0cy5lcShpKTtcblxuICAgICAgICAgICAgICAgICRlbFxuICAgICAgICAgICAgICAgIC5maW5kKCcuYmFyJylcbiAgICAgICAgICAgICAgICAuY3NzKCB7ICdoZWlnaHQnOiAoMTAwIC0gdGhpcy5jdXJyZW50U3RhdHNbaV0pICsgJyUnIH0gKTtcblxuICAgICAgICAgICAgICAgIGlmICAgICAoIG1heCA9PSB0aGlzLmN1cnJlbnRTdGF0c1tpXSApeyAkZWwuYWRkQ2xhc3MoICdoaWdobGlnaHRfX2hpZ2gnKTsgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoIG1pbiA9PSB0aGlzLmN1cnJlbnRTdGF0c1tpXSApeyAkZWwuYWRkQ2xhc3MoICdoaWdobGlnaHRfX2xvdycgKTsgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBpc0xBc3RZZWFyKCk6IGJvb2xlYW4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5jYWxlbmRhclsgMCBdLm5hbWUgPT0gdGhpcy5jdXJyZW50WWVhcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgaXNGaXJzdFllYXIoKTogYm9vbGVhbiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmNhbGVuZGFyWyB0aGlzLmRhdGEuY2FsZW5kYXIubGVuZ3RoIC0gMSBdLm5hbWUgPT0gdGhpcy5jdXJyZW50WWVhcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgbG9hZFllYXIoIHllYXJOYW1lOiBudW1iZXIsIGU/OiBKUXVlcnlLZXlFdmVudE9iamVjdCApIHtcblxuICAgICAgICAgICAgaWYoIGUgKSBlLnByZXZlbnREZWZhdWx0KCk7IC8vIHByZXZlbnQgdGhlIGRlZmF1bHQgYWN0aW9uIChzY3JvbGwgLyBtb3ZlIGNhcmV0KVxuXG4gICAgICAgICAgICB0aGlzXG4gICAgICAgICAgICAgICAgLmdldFN0YXRzKHllYXJOYW1lKVxuICAgICAgICAgICAgICAgIC50aGVuKCB0aGlzLnNldFN0YXRzLmJpbmQoIHRoaXMgKSApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5sZXQgbWFpbjogYW55O1xuXG5cbiQoJ2RvY3VtZW50Jylcbi5yZWFkeSggKCkgPT4ge1xuICAgIG1haW4gPSBuZXcgYXBwLk1haW4oKTtcbiAgICBtYWluLmluaXQoKTtcbn0pO1xuXG5cbiJdfQ==
